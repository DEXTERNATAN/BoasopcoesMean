"use strict";var express=require("express"),router=express.Router(),mongoose=require("mongoose"),User=mongoose.model("User");module.exports=function(){return router.post("/validate",function(req,res){User.findOne({emailKey:req.body.key},function(err,user){return err||!user?res.sendStatus(404):user.emailConfirm===!0?res.sendStatus(403):void User.update({emailKey:req.body.key},{emailConfirm:!0},{multi:!0},function(err,nb){return err?res.sendStatus(404):void(1===nb?res.sendStatus(200):res.sendStatus(500))})})}),router.post("/unvalidate",function(req,res){User.findOne({emailKey:req.body.key,email:req.body.email},function(err,user){return err||!user?res.sendStatus(404):user.emailConfirm===!0?res.sendStatus(403):void User.remove({_id:user._id},function(err){return err?res.sendStatus(404):void res.sendStatus(200)})})}),router};