"use strict";var express=require("express"),app=express(),passport=require("passport"),flash=require("connect-flash"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),session=require("express-session"),path=require("path"),csrf=require("csurf"),fs=require("fs"),config=JSON.parse(fs.readFileSync(path.join(__dirname,"../config.json"),"utf8")),strategiesDir=fs.readdirSync(path.join(__dirname,"./lib/strategies")),modelsDir=fs.readdirSync(path.join(__dirname,"./models")),nodemailer=require("nodemailer");app.set("env",app.get("env")||"production");var transporter=nodemailer.createTransport(config[app.get("env")].mail);require("./lib/database")(app.get("env")),modelsDir.forEach(function(file){file.indexOf(".js")>-1&&require("./models/"+file)}),strategiesDir.forEach(function(file){file.indexOf(".js")>-1&&require("./lib/strategies/"+file)(app.get("env"),passport,transporter)}),app.use(cookieParser(config[app.get("env")].cookieSecret,{httpOnly:!0})),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(session({name:"sessionID",secret:config[app.get("env")].sessionSecret,cookie:{path:"/",httpOnly:!0,secure:!1,maxAge:72e5},rolling:!0,resave:!1,saveUninitialized:!0})),app.use(passport.initialize()),app.use(passport.session()),app.use(flash()),app.use(csrf()),app.use(function(req,res,next){res.cookie("XSRF-TOKEN",req.csrfToken()),next()}),require("./router")(app,passport),module.exports=app;